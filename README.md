# Admin Query Demo

**Natural language → SQL + Insights for Rails Admins**  
Powered by [Ollama](https://ollama.com/) (`duckdb-nsql`, `llama3.2`) & ActiveRecord.

---

## 📖 Overview

This Rails demo shows how administrators can ask questions in plain English and receive:

1. **Auto-generated SQL** using [Ollama's `duckdb-nsql`](https://ollama.com/library/duckdb-nsql) model.
2. **Executed results** safely via Rails **ActiveRecord**.
3. **Readable summaries** of the results generated by [Ollama's `llama3.2`](https://ollama.com/library/llama3.2).

This makes it easy to build admin dashboards and reporting tools powered by natural language queries.

---

## ✨ Features

- 🆙 Translate **natural language queries → SQL** automatically.
- 🗄️ Run queries through **ActiveRecord** (PostgreSQL, MySQL, SQLite, etc.).
- 📝 Get **human-friendly summaries** of query results.
- 🔌 Works with [ruby_llm](https://rubyllm.com) and [Ollama](https://ollama.com/).
- ⚡ Drop-in **Rails helper** for admin dashboards.

---

## 🚀 Getting Started

### Prerequisites

- Ruby on Rails (with ActiveRecord configured).
- [Ollama](https://ollama.com/download) installed and running locally (`ollama serve`).
- Models available locally:
  - `duckdb-nsql` (for natural language → SQL).
  - `llama3.2` (for result summarization).

### Installation

1. **Clone the repository:**

   ```bash
   git clone https://github.com/Selectus2/admin_query_demo.git
   cd admin_query_demo
   ```

2. **Install dependencies:**

   ```bash
   bundle install
   ```

3. **Pull required Ollama models:**

   ```bash
   ollama pull duckdb-nsql
   ollama pull llama3.2
   ```

4. **Configure `ruby_llm`:**

   Create `config/initializers/ruby_llm.rb` in your Rails app:

   ```ruby
   RubyLLM.configure do |config|
     config.ollama_api_base = 'http://localhost:11434/v1'
   end
   ```

---

## 🛠 Usage

Include the helper and call `process_natural_language_query`:

```ruby
include AdminHelper

result = process_natural_language_query("List the top 5 users by order total")

puts result[:sql_generated]  # => the generated SQL
puts result[:summary]        # => natural language summary
pp result[:data]             # => query results
```

---

## 📂 Example Queries

| Natural Language Question | Sample Generated SQL | Example Summary |
|---------------------------|---------------------|-----------------|
| "How many active users joined in the last 30 days?" | `SELECT COUNT(*) FROM users WHERE status='active' AND created_at > NOW() - interval '30 days';` | "There are 42 active users who joined in the last 30 days." |
| "Show me the top 5 products with low stock." | `SELECT * FROM products WHERE stock < 10 ORDER BY stock ASC LIMIT 5;` | "Here are 5 products that are running low on stock." |

---

## ⚙️ Tech Stack

- **Ruby on Rails** + **ActiveRecord**
- [ruby_llm](https://rubyllm.com) — unified interface for LLMs
- [Ollama](https://ollama.com) — local model runner
- **Models:**
  - [duckdb-nsql](https://ollama.com/library/duckdb-nsql) (natural language → SQL)
  - `llama3.2` (summarization)
